# 코드 리뷰 (2026-02-22)

## 전체 평가

- **아키텍처는 명확함**: `database`/`business`/`web(api)`/`utils`/`sync`로 레이어가 분리되어 있고, 계산 로직도 별도 모듈로 분리되어 유지보수성 기반이 좋습니다.
- **기본 품질은 양호함**: 계산 로직 단위 테스트가 존재하고, 현재 테스트는 모두 통과합니다.
- **다만 운영 관점의 리스크가 존재**: 권한 검증 누락, 기본 관리자 비밀번호 fallback, 일부 기능 버그 가능성이 확인되었습니다.

---

## 주요 강점

1. **비즈니스 로직 분리**
   - 인원 계산(`calculations.py`)과 데이터 처리(`work_record_service.py`)가 분리되어 있어 변경 영향 범위가 비교적 명확합니다.

2. **DB 접근 일관성**
   - `contextmanager` 기반 트랜잭션 처리로 커밋/롤백 흐름이 통일되어 있습니다.

3. **현실적인 데이터 동기화 구현**
   - 클라우드 SDK 의존 대신 폴더 동기화 기반으로 구현해 운영 난이도를 낮춘 점은 장점입니다.

---

## 개선이 필요한 이슈

### 1) [높음] Excel export 필드명 불일치로 순번 누락 가능

- `get_records_for_date()`는 키를 camelCase로 반환하는데(`recordNumber`),
- `export_to_excel()`은 `record.get('record_number')`를 조회하고 있어 값이 비어질 수 있습니다.
- 영향: 엑셀 내 "순번" 컬럼이 공란으로 저장될 가능성.

**권장 조치**
- `record.get('recordNumber')`로 수정하거나,
- API 반환/저장 시점의 키 네이밍 규칙을 단일화(snake_case 또는 camelCase)하세요.

---

### 2) [높음] 관리자 API에 서버 측 권한 검증 부재

- `admin_approve_user`, `admin_delete_user`, `admin_update_*` 계열 API가 인자로 `admin_id`를 받지만,
- 실제로 해당 사용자가 관리자 권한인지 서버 측에서 검증하지 않습니다.
- Eel 환경에서 프론트엔드 우회 호출이 가능하면 권한 상승 리스크가 발생할 수 있습니다.

**권장 조치**
- 모든 관리자 API에서 `admin_id`의 role/status를 서버에서 재검증하세요.
- 가능하면 세션 토큰 기반 인증(서명/만료 포함)으로 전환하세요.

---

### 3) [중간] 기본 관리자 비밀번호 fallback 하드코딩

- 초기 관리자 계정 생성 시 설정값이 없으면 `'44448901'`을 기본값으로 사용합니다.
- 배포 환경에서 설정 누락 시 취약한 디폴트 자격증명으로 노출될 수 있습니다.

**권장 조치**
- 기본값 사용을 금지하고, 초기 실행 시 강제 비밀번호 설정 플로우를 두세요.
- 최소 비밀번호 정책(길이/복잡도)과 최초 로그인 시 변경 강제를 권장합니다.

---

### 4) [중간] `src/web/api.py` 단일 파일 비대화

- 인증/관리자/리포트/엑셀/동기화/텔레그램까지 한 파일에서 처리되어 변경 충돌 및 회귀 위험이 큽니다.

**권장 조치**
- 도메인별 모듈 분리:
  - `api_auth.py`
  - `api_admin.py`
  - `api_records.py`
  - `api_reports.py`
  - `api_sync.py`

---

## 테스트 결과

- `pytest -q` 실행 결과: **6 passed**

---

## 우선순위 제안

1. 관리자 API 서버 권한 검증 추가 (보안)
2. Excel export 필드명 정합성 수정 (기능 정확도)
3. 관리자 초기 비밀번호 정책 개선 (보안)
4. API 모듈 분리 리팩터링 (유지보수성)
